<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="main.css">
    <title>Smart Window</title>
    <script src="https://kit.fontawesome.com/9c10c72a2c.js" crossorigin="anonymous"></script>
    <style>
        :root {
            --main-background-color: rgb(19, 20, 23);
            --main-text-color: rgb(255, 255, 255);
            --secondary-background-color: rgb(45, 48, 57);
            --tertiary-background-color: #444857;
        }

        body {
            background-color: var(--main-background-color);
            color: var(--main-text-color);
            padding: 0 2rem;
        }

        .container {
            background-color: var(--secondary-background-color);
            border-radius: 10px;
            padding: 1.5rem 1.5rem 2rem;
            margin: 2rem 0;
        }

        .button {
            background-color: var(--tertiary-background-color);
            cursor: pointer;
            border-radius: 4px;
            text-align: center;
            margin: 0 10px 0 0;
            padding: 10px 16px;
            display: inline-block;
        }

        .slideContainer {
            width: 80%;
            margin: auto;
        }

        .slider {
            -webkit-appearance: none;
            appearance: none;
            width: 100%;
            height: 25px;
            background: #d3d3d3;
            outline: none;
            opacity: 0.7;
            -webkit-transition: .2s;
            transition: opacity .2s;
        }

        .slider:hover {
            opacity: 1;
        }

        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 25px;
            height: 25px;
            background: #4CAF50;
            cursor: pointer;
        }

        .slider::-moz-range-thumb {
            width: 25px;
            height: 25px;
            background: #4CAF50;
            cursor: pointer;
        }

        .auto .far {
            display: none;
        }

        .auto .fas {
            display: block;
        }

        .auto .far {
            display: block;
        }

        .auto .fas {
            display: none;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>Hello World</h1>
        <div class="slideContainer">
            <input type="range" min="1" max="100" value="50" class="slider" id="intensity">
        </div>
        <div class="button" id="autoBrightness">
            <i class="fas fa-robot toggle"></i>
            <i class="far fa-lightbulb"></i>
        </div>
    </div>

    <script>
        // let powerBtn = document.getElementById("power-btn");
        const HTTP = new XMLHttpRequest();

        // let powerFn = function () {
        //     const URL = "something here";
        //     HTTP.open("POST", URL);
        //     HTTP.send();

        //     HTTP.onreadystatechange = function () {
        //         if (this.readyState == 4 && this.status == 200) {
        //             console.log(HTTP.responseText);
        //         } else {
        //             console.error(HTTP.responseText);
        //             console.log(`Status: ${HTTP.responseText}`);
        //         }
        //     }
        // };

        function outputUpdate(vol) {
            const URL = "something for intensity here";
            $('#intensity').text(Math.round(vol / 2.55) + '%');

            if ($('#autobrightness').hasClass('btn-primary')) {
                $('#autobrightness').trigger('click');
            }

            HTTP.open("POST", URL);
            HTTP.send({ "brightness": vol });

            HTTP.onreadystatechange = function () {
                if (this.readyState == 4 && this.status == 200) {
                    console.log(HTTP.responseText);
                } else {
                    console.error(HTTP.responseText);
                    console.log(`Status: ${HTTP.responseText}`);
                }
            }

            // $.ajax({
            //   method: "POST",
            //   url: "index.php",
            //   data: { brightness: vol}
            // });
        }

        function updateAutoBrightness() {
            let autoBtn = document.getElementById("autoBrightness");
            autoBtn.classList.toggle("auto");

            // Auto Brightness
            let isAuto = (autoBtn.hasClass('auto')) ? 1 : 0;

            // $.ajax({
            //     method: "POST",
            //     url: "index.php",
            //     data: { autoBrightness: isAuto }
            // })
            //     .done(function (msg) {
            //         $('input[type=range]').val(msg);
            //         $('#volume').text(Math.round(msg / 2.55) + '%');
            //     });

            HTTP.open("POST", URL);
            HTTP.send({ autoBrightness: isAuto });

            HTTP.onreadystatechange = function () {
                if (this.readyState == 4 && this.status == 200) {
                    console.log(HTTP.responseText);
                    document.getElementById("intensity").value = this.response;
                    document.getElementById("intensityDisplay").innerText = `${this.response}%`;
                } else {
                    console.error(HTTP.responseText);
                    console.log(`Status: ${HTTP.responseText}`);
                }
            }
        }

        $('#autobrightness').on('click', updateAutoBrightness);


        powerBtn.addEventListener("click", powerFn);
    </script>
</body>

</html>